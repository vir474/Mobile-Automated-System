var jnedfd=new Array();var jnedinst=new Array();var jareaids=new Array();var jphpareaids=new Array();function jApplication(){console.log("rootscript object init");this.buttons=new Array();this.autocheckVar=false;this.onDOMready=function(codePassed){jCore.DOMcodeToFire.push(codePassed);if(jCore.DOMfctset===false){this.browserDOMready()}};this.browserDOMready=function(){jCore.DOMfctset=true;jCore.flagIE=false;if(!jCore.flagIE){if(document.addEventListener){document.addEventListener("DOMContentLoaded",jCore.DOMready,null)}else{if(/WebKit/i.test(navigator.userAgent)){var _timer=setInterval(function(){if(/loaded|complete/.test(document.readyState)){clearInterval(_timer);jCore.DOMready()}},10)}else{window.onload=jCore.DOMready}}}};this.run=function(namekey,extra,htmlEntity,RemoteLoader){console.log("rootscript run function");var curButton=this.buttons[namekey];console.log("Form Name "+curButton.formName.toString());this.form=eval("document."+curButton.formName);if(curButton.pagi){this.navPagi(curButton.limitstart,extra)}var fn=curButton.formName;var f=document.forms[fn];var l=f.elements.length;fn="#"+fn;app.formdata=new FormData($(fn)[0]);var g_postA={};var i=0;for(i=0;i<l;i++){if(f.elements[i].type=="checkbox"){}if(f.elements[i].type=="radio"){}else{var temp=f.elements[i].name;g_postA[temp]=f.elements[i].value}}if(curButton.task){g_postA.task=curButton.task;app.formdata.append("task",curButton.task)}if(curButton.controller){g_postA.controller=curButton.controller;app.formdata.append("controller",curButton.controller)}window.localStorage.setItem("local_postA",JSON.stringify(g_postA));console.log("Parameters loaded and stored locally "+window.localStorage.getItem("local_postA"));var temp=angular.element($("#main_body")).scope();temp.goTo(null);if(curButton.nosubmit){return this.checkbox(curButton,extra)}if(curButton.listing){this.joobiTask(curButton,extra)}if(curButton.select&&!this.checkSelection(curButton,namekey)){return false}if(curButton.confirm&&!this.askConfirmation(namekey)){return false}if(curButton.validation&&!this.validate(curButton.formName)){return false}if(curButton.pagi){this.navPagi(curButton.limitstart,extra)}if(curButton.cfil){this.changeFilter(curButton.limitstart)}if(curButton.disableAll){this.disableAll()}console.log("rootscript run before sendform ()"+curButton);console.log("rootscript run after sendform ()");return false};this.beforeAutosave=function(namekey,extra,htmlEntity){var curButton=this.buttons[namekey];this.form=eval("document."+curButton.formName);this.loadNeditData();if(curButton.phpedit){this.loadPHPeditData()}return true};this.wizard=function(button){myElement=jQuery("#viewWizard");var display=myElement.css("display");if(display=="none"){myElement.show()}else{myElement.hide()}var form=eval("document."+button.formName);var task=eval(form.task);if(task){form.task.value=button.task}var url=jCore.ajxprms.url;jQuery.ajax({url:url,data:jQuery(form).serialize()+"&controller=output",method:"POST",success:function(msg){},error:function(){}})};this.loadjQuery=function(path){var jquerys=$("jquery");if(jquerys==null){this.loadjs(path+"jquery-1.5.1.min.js","jquery")}};this.loadjs=function(path,id){if(path!=""){var script=document.createElement("script");script.setAttribute("type","text/javascript");script.setAttribute("src",path);if(id!=""){script.setAttribute("id",id)}document.getElementsByTagName("head")[0].appendChild(script)}};this.removejQuery=function(){this.removejs("jquery")};this.removejs=function(id){if(id!=""){script=$(id);script.parentNode.removeChild(script)}};this.autocheck=function(button,extra){extra.value=$(extra.namekey).value;if(extra.value==""||extra.value==0){return true}notexist=extra.notexist;var form=eval("document."+button.formName);var task=eval(form.task);if(task){form.task.value=button.task}var extraStr="";for(var i in extra){index=i;extraStr+="&"+i+"="+extra[i]}var url=button.ajxUrl;var ajax=new Request({url:url,data:$(form).toQueryString()+extraStr+"&controller=output",method:"POST",onComplete:function(msg){if(notexist==1){if(msg==0){msg=1}else{msg=0}}if(msg==1){joobi.autocheckVar=true}else{joobi.autocheckVar=false}}});ajax.send()};this.creditcard=function(namekey,cardnameid,cardnumid,expdateid){var curButton=this.buttons[namekey];var formName=curButton.formName;if(!this.validate(formName)){return false}if(!checkCreditCard(cardnameid,cardnumid)){return false}this.sendForm(curButton);return false};this.joobiTask=function(curButton,extra){switch(curButton.task){case"order":if(curButton.total){for(var j=0;j<=curButton.total;j++){box=eval("this.form.em"+j);if(box){box.checked=true}}}else{this.checkLine(extra)}break;default:if(extra.em){curButton.taskvar+=extra.value;this.tickBox(extra.em)}}if(curButton.sorting){this.form.sorting.value=extra;task=curButton.params}var testvar=eval(this.form.taskvar);if(testvar){this.form.taskvar.value=curButton.taskvar}if(curButton.securedyid){this.form.joobieids.value=eval("this.form.joobieids"+curButton.securedyid).value}};this.tickBox=function(id){box=eval("this.form."+id);if(box){box.checked=true;this.form.boxchecked.value=1}else{return false}};this.disableAll=function(){menuHori=$("joobiMenu");if(menuHori){$("joobiMenu").parentNode.parentNode.setStyle("display","none")}switch(jCore.cms){default:cmsToolbar=$("header-box");break}if(cmsToolbar){cmsToolbar.setStyle("display","none")}};this.checkbox=function(button,extra){switch(button.task){case"toggleAllBox":box=$(button.checkid);var i=button.limitstart;var currentElement=eval("this.form.em"+i);while(currentElement){em=$("em"+i);em.checked=box.checked;i++;currentElement=eval("this.form.em"+i)}if(extra){this.form.boxchecked.value=i}else{this.form.boxchecked.value=0}break;case"checkLine":this.checkLine(extra);break}return true};this.flip=function(htmlId,msg){htmlEntity=$(htmlId);if(msg){msgEntity=$("msg"+htmlId)}if(htmlEntity.style.display=="none"){htmlEntity.style.display="block";if(msg){msgEntity.style.display="none"}}else{htmlEntity.style.display="none";if(msg){msgEntity.style.display="block"}}};this.flipChild=function(htmlId){htmlEntity=$(htmlId);var i=0;for(i=0;i<htmlEntity.childNodes.length;i++){if(htmlEntity.childNodes[i].style.display=="none"){htmlEntity.childNodes[i].style.display="block"}else{htmlEntity.childNodes[i].style.display="none"}}};this.checkLine=function(boxid){boxRadio=eval("this.form."+boxid);parentObj=boxRadio;runaway=false;while(!runaway){if(parentObj){parentObj=parentObj.parentNode}if(parentObj&&parentObj.nodeName=="BODY"){return false}if(parentObj&&parentObj.nodeName=="TR"){runaway=true}if(!parentObj){return false}}parentid=parentObj.getAttribute("id");box=document.getElementById(boxid);row=document.getElementById(parentid);if(row.className){row.className=jQuery.trim(row.className)}if(row.className.indexOf("rowSelected")==-1){if(box.checked==true){box.checked=false}}if(row.className.indexOf("rowSelected")!=-1){if(box.checked==false){box.checked=true}}if(box.checked==true){box.checked=false;this.form.boxchecked.value--;row.className=row.className.substring(0,4)}else{if(box.type=="radio"){if(this.form.boxchecked.value==1){this.form.boxchecked.value--}var tr=document.getElementsByTagName("tr");for(var i=0;i<tr.length;i++){cssclass=tr[i].className;if(cssclass.indexOf("rowSelected")!=-1){cssclass=cssclass.substring(0,4);tr[i].className=cssclass}}}box.checked=true;this.form.boxchecked.value++;row.className+=" rowSelected"}return true};this.changeFilter=function(limitname){limitstart=eval("this.form."+limitname);if(limitstart){limitstart.value=""}};this.navPagi=function(limitname,extra){console.log("pagi element "+this.form.name);limitstart=eval("this.form."+limitname);limitstart.value=extra};this.popClose=function(){return window.parent.SqueezeBox.close()};this.validate=function(formname){if(!(typeof validateForm=="function")){return true}var status=validateForm(formname);return status};this.checkSelection=function(curButton,namekey){var form=eval("document."+curButton.formName);if(form.boxchecked.value==0){return false}return true};this.askConfirmation=function(namekey){if(confirm(jCore.msg["conf_"+namekey])){return true}else{return false}};this.loadNeditData=function(){for(i=0;i<jnedinst.length;i++){textbox=$(jareaids[i]);if(jnedinst[i].innerHTML=="<br>"){textbox.value=""}else{textbox.value=jnedinst[i].innerHTML}}return false};this.loadPHPeditData=function(){for(i=0;i<jphpareaids.length;i++){textbox=$(jphpareaids[i]);textbox.value=editAreaLoader.getValue(jphpareaids[i])}return false};this.sendForm=function(button,namekey,extra){var form=eval("document."+button.formName);console.log("rootscript sendform() "+button.formName);var task=eval(form.task);console.log("task at send form "+button.task);if(task){form.task.value=button.task}if(button.controller){var contro=eval(form.controller);if(contro){contro.value=button.controller}}console.log("rootscript ajax check");if(button.ajx==1){jCore.ajxprms.url=button.ajxUrl;var url=jCore.ajxprms.url;jCore.ajxprms.on=button.ajx;jCore.ajxprms.extfct=button.ajxComplete;var extraData="";var evals=0;if(button.ajaxToggle){jCore.ajxprms.div=extra.divId;var extraStr="";for(var i in extra){index=i;extraStr+="&"+i+"="+extra[i]}extraData="&ajax=1&namekey="+namekey+extraStr;evals=1}else{jCore.ajxprms.div="div"+button.formName}var func=eval("window."+jCore.ajxprms.extfct);if(func){var ajax=new Request({url:url,data:$(form).toQueryString(),method:"POST",async:false,onComplete:function(msg){func(msg,url,form)}})}else{var ajax=new Request({url:url,data:$(form).toQueryString()+extraData,async:false,method:"POST",onComplete:function(msg){jwriteResponse(msg,"","",0,evals)}})}ajax.send()}else{try{$(form).submit()}catch(e){}status=form.submit()}if(button.refresh){parent.location.reload()}else{if(button.popclose){this.popClose()}}return true};this.wait=function wait(msecs){var start=new Date().getTime();var cur=start;while(cur-start<msecs){cur=new Date().getTime()}}}var joobi=new jApplication();var jCore={themecolor:"red",site:"",confirm:[],nedit:false,ajxprms:[],DOMfctset:false,DOMcodeToFire:[],msg:[],req:[],DOMready:function(){for(i=0;i<jCore.DOMcodeToFire.length;i++){jCore.DOMcodeToFire[i]()}}};function jwriteResponse(msg,div,classes,append,evals){if(!div){div=jCore.ajxprms.div}if(!classes){classes=jCore.ajxprms.extfct}var evaluateJS=evals;mydiv=$(div);if(mydiv){if(append){$(div).innerHTML+=msg}else{if((evaluateJS)&&(msg)&&(msg.indexOf("noeval")===-1)){evaluateJS=1}else{evaluateJS=0}if(evaluateJS){eval(msg)}else{$(div).innerHTML=msg}}}}function deletecross(d,e,c,b,h,g){var f=new Request({url:d,postBody:"sid="+b+"&eid="+c+"&"+g+"="+h+"&map="+g});f.send();div="jmpic_"+b+"_"+c+"_"+h;mydiv=$(div);var a=new Fx.Style(div,"opacity").addEvent("onComplete",function(){mydiv.style.display="none"});a.start(1,0)};